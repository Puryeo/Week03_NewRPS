<New_Rock_Paper_Scissors> Core Loop Prototype PRD (Product Requirements Document)

Note: The Addendum section supersedes any conflicting statements earlier in this document.

1. Product Goal
The objective of this prototype is to evaluate the fun of the most basic game loop of 

<New_Rock_Paper_Scissors>: the process of finding the optimal move over 5 turns while knowing the composition of the opponent's hand. This will serve to verify if the core mechanics are sufficiently engaging and robust before adding complex systems like Jokers.

2. Feature Specifications
2.1. Game Round Flow

Round Start: When the game begins, the system will generate the AI's starting hand (default 6 cards; configurable via Inspector) and initialize all variables (score, turn).


Information Display: The types and quantities of the cards held by the AI will be displayed to the player via text.


Turn Progression (default 5 turns; configurable):

The player selects one of three buttons: 'Rock', 'Paper', or 'Scissors'.

The AI selects and plays one card from its remaining hand (front when draw-policy active, otherwise random).

The result (Win/Draw/Loss) is determined and the score is recorded.

The information about the AI's remaining hand composition is updated.


Round End: After the configured last turn concludes, the final score is displayed and a 'Restart' button is activated.

2.2.
Detailed Core Features



AI Hand Generation: At the start of a round, cards will be selected from 'Rock', 'Paper', and 'Scissors' and stored in a list (default 6; configurable).

Player Input: The player submits their choice via the 'Rock', 'Paper', or 'Scissors' buttons. The game will wait for this input before proceeding.


Result Determination: Follows standard Rock-Paper-Scissors rules.


Scoring System:

Win: 5 points

Draw: 3 points

Loss: 0 points


UI Feedback: The following information must be updated on-screen immediately each turn:

The AI's remaining hand composition

The current turn number (e.g., "3/5")

The current cumulative score

The result of the turn (e.g., "Win!")


3. Technical Specifications
3.1.
Development Environment



Engine: Unity 6000.0.56f


Render Pipeline: Universal Render Pipeline (URP), configured for a 2D environment

3.2.
Core Classes and Data Structures


GameManager.cs


Description: The core controller class that manages all game states and flow.


Key Variables:

C#

// --- Game State Variables ---
private List<Choice> aiHand; // A list to store the AI's remaining cards
private int currentTurn; // The current turn (1-5) [cite: 15]
private int currentScore; // The current score [cite: 15]

// --- UI Reference Variables ---
public TextMeshProUGUI aiHandText; // Text for AI hand info [cite: 16]
public TextMeshProUGUI turnText; // Text for the current turn [cite: 16]
public TextMeshProUGUI scoreText; // Text for the current score [cite: 16]
public TextMeshProUGUI resultText; // Text for the turn result [cite: 17]
public GameObject restartButton; // The restart button game object [cite: 17]
Key Functions:

C#

void StartRound(); // Initializes and starts the game
void PlayerMakesChoice(Choice playerChoice); // The main logic called upon player selection [cite: 18]
void UpdateUI(); // Updates all UI text elements to reflect the current state [cite: 18]
void EndRound(); // Called after 5 turns to end the round
Choice (enum)


Description: An enum to clearly manage the Rock, Paper, and Scissors choices.


Structure:

C#

public enum Choice { Rock, Paper, Scissors }

Note: For tag authoring only, a sentinel value Choice.None exists in code. Gameplay UI continues to expose only Rock/Paper/Scissors.

4. Features Out of Scope
To focus on the prototype's objectives, the following features are explicitly excluded from the scope of work:

// Joker System ? superseded by Addendum (see below)
Consumables System

Stage, Boss, and Score Hurdle Systems

All sound, animations, and visual effects (VFX)

Title screen and any other UI screens



====================
Addendum / Handover (Prototype Iteration with Modular Jokers)
====================

A. Summary of Tasks Completed (Updated)
- Core loop refactor to 6-card hands (default) and 5 turns (configurable via Inspector).
- Inspector configurables: handSize, turnsToPlay, guaranteedRocks/Papers/Scissors, playerRerollMax.
- Reroll: allowed only before Turn 1, regenerates player hand with guaranteed counts, then shuffles.
- DEBUG HUD: runtime toggles for Jokers, shows Current (highest priority) and full Pipeline via CurrentText/PipelineText.
- Modular Joker architecture implemented (Tag-based JokerData + JokerManager). Legacy IJoker/enum pipeline removed.
- Scout information fix: shows first card and the actual last-play turn card, aligned with AI drawing from front when active.
- Additive scoring pipeline: Jokers modify the base rule (Win +5 / Draw +3 / Loss +0) by adding deltas, enabling safe synergies.

B. Current Rule Set (overrides/extends earlier sections)
- Default: Player/AI each receive 6 cards; turnsToPlay defaults to 5. Both values are configurable in Inspector.
- Base scoring remains: Win +5, Draw +3, Loss +0. All Joker effects are additive deltas to this base.
- AI draw policy: if a Joker with ForceAIDrawFromFront is active, AI draws from the front for consistency; otherwise random.
- Turn count independence: turnsToPlay is independent from hand sizes. If either side runs out of cards before all turns are played, the round ends early.

C. Modular Joker System (Tag-based, Data-Driven Only)
- Data Model
  - JokerData (ScriptableObject): jokerName, description, tags (List<JokerTag>).
  - JokerTag: category (Timing/Condition/Effect), type (RoundStart/TurnSettlement etc.), parameters (Outcome/Choice/int/string, filters).
  - Default values: Choice.None/Outcome.None/JokerTimingType.None are available for ¡°unused¡± fields.
- Manager (JokerManager)
  - Acts as Tag Interpreter and Effect Executor.
  - Multiple active Jokers with ordered priority (last toggled = highest).
  - Public API: SetJoker(JokerData), ToggleJoker(JokerData), GetCurrentJokerName(), GetPipelineDescription(), AIDrawFromFront.
  - Executes tag-defined effects at specific timings: OnRoundStart(GameManager), ExecuteTurnSettlementEffects(GameContext).
  - RoundStart sets AIDrawFromFront=true for this round if ForceAIDrawFromFront tag is present (intValue != 0).
- Score pipeline is additive: GameManager builds GameContext and JokerManager accumulates scoreDelta via Effect tags.
- Tag schema (incremental):
  - Timing: RoundStart, TurnSettlement
  - Condition: OutcomeIs, PlayerChoiceIs, PlayedAtLeastCount, ConsecutiveDrawWithChoiceIs, IsLastTurn
  - Condition (hand comparison): PlayerHasMoreOfChoiceThanAI
  - Effect: AddScoreDelta, ForceAIDrawFromFront, ShowInfo, FinalScoreMultiplier
  - Effect (AI hand mutation): ReplaceAIRandomCardsToChoice (intValue cards -> choiceParam)

D. Implemented Jokers (expressed via tags)
- All_In_Rock
  - Target: playerChoice == Rock
  - Win: +15 (=> base 5 + 15 = 20), Draw/Loss: -9999
- The_Contrarian
  - Target: all
  - Win: -5 (=> 0), Draw: -1 (=> 2), Loss: +8 (=> 8)
- Scout
  - Target: information
  - On RoundStart or when toggled, shows AI first/last-turn card (GameManager.PeekAIFront/PeekAIBack).
  - ForceAIDrawFromFront active for the round when enabled.
- Blueprint (planned): Paper_Dominance
  - Timing: RoundStart
  - Condition: PlayerHasMoreOfChoiceThanAI(choiceParam=Paper)
  - Effect: ReplaceAIRandomCardsToChoice(choiceParam=Rock, intValue=2)

M. Development Summary / Changelog
- Implemented tag-based Joker system (JokerData + JokerTag + JokerEnums + GameContext). Legacy IJoker/enum removed.
- JokerManager refactored into a tag interpreter and effect executor. Added ExecuteTurnSettlementEffects and RoundStart handling.
- Additive scoring pipeline wired in GameManager using GameContext (baseScore -> scoreDelta accumulation).
- Round-scoped AI draw policy via ForceAIDrawFromFront at RoundStart.
- DEBUGHUD refactored to asset-based toggles; UI fields renamed to CurrentText/PipelineText.
- Added unified logging utility (RPSLog) and integrated logs for round/turn/joker events.
- Added validation warnings for malformed/None tag parameters.
- Added round history/meta to GameContext and new conditions/effect:
  - Conditions: PlayedAtLeastCount, ConsecutiveDrawWithChoiceIs, IsLastTurn
  - Effect: FinalScoreMultiplier (applies immediately)
- Archetype flags added to JokerData for spawn/design classification: Anchor, Payoff, Catalyst, Utility, Risk.
- New RoundStart hand-comparison condition and AI hand mutation effect:
  - Condition: PlayerHasMoreOfChoiceThanAI
  - Effect: ReplaceAIRandomCardsToChoice

N. Open Items / Planned Work
- Author sample JokerData assets in Unity (All_In_Rock, The_Contrarian, Scout, Paper_Dominance).
- QA checklist run (manual) per section J.
- Spawn system (planned):
  - JokerSpawnWeights (ScriptableObject): per-archetype weights (Anchor/Payoff/Catalyst/Utility/Risk), optional per-joker overrides.
  - JokerSpawnManager (runtime): API GetRandomJoker(pool, weights[, mask, seed]); archetype mask filtering + weighted random.
- Future tags: turn-index based conditions/effects, additional info/flow modifiers as needed.